<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å‰ç«¯åŠŸèƒ½æ¸¬è©¦</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 20px auto;
            padding: 20px;
            background: #1a1d29;
            color: #e8eaf0;
        }
        .test-section {
            background: #2a2f3f;
            border: 1px solid #3a4052;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .test-section h2 {
            color: #d4af37;
            margin-top: 0;
        }
        .test-item {
            padding: 10px;
            margin: 10px 0;
            background: #343a4f;
            border-radius: 4px;
        }
        .status {
            font-weight: bold;
            padding: 4px 8px;
            border-radius: 4px;
        }
        .status.pass {
            background: #6b9080;
            color: white;
        }
        .status.fail {
            background: #ef4444;
            color: white;
        }
        .status.pending {
            background: #8b9dc3;
            color: white;
        }
        button {
            background: #d4af37;
            color: #1a1d29;
            border: none;
            padding: 10px 20px;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            margin: 5px;
        }
        button:hover {
            opacity: 0.8;
        }
        .log {
            background: #1a1d29;
            border: 1px solid #3a4052;
            padding: 10px;
            margin-top: 10px;
            max-height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
        .log-entry {
            margin: 2px 0;
        }
        .log-entry.error {
            color: #ef4444;
        }
        .log-entry.success {
            color: #6b9080;
        }
        .log-entry.info {
            color: #8b9dc3;
        }
    </style>
</head>
<body>
    <h1>ğŸ§ª å‰ç«¯åŠŸèƒ½æ¸¬è©¦å„€è¡¨æ¿</h1>

    <div class="test-section">
        <h2>1. API Endpoints æ¸¬è©¦</h2>
        <button onclick="testAPIs()">åŸ·è¡Œ API æ¸¬è©¦</button>
        <div id="api-results" class="log"></div>
    </div>

    <div class="test-section">
        <h2>2. System Control æ¸¬è©¦</h2>
        <button onclick="testSystemStatus()">æ¸¬è©¦ç³»çµ±ç‹€æ…‹</button>
        <button onclick="testStartSystem()">æ¸¬è©¦å•Ÿå‹•ç³»çµ± (æ¨¡æ“¬)</button>
        <button onclick="testStopSystem()">æ¸¬è©¦åœæ­¢ç³»çµ± (æ¨¡æ“¬)</button>
        <div id="system-results" class="log"></div>
    </div>

    <div class="test-section">
        <h2>3. Tab åˆ‡æ›æ¸¬è©¦</h2>
        <button onclick="testTabSwitching()">æ¸¬è©¦ Tab åˆ‡æ›</button>
        <div id="tab-results" class="log"></div>
    </div>

    <div class="test-section">
        <h2>4. REFRESH æŒ‰éˆ•æ¸¬è©¦</h2>
        <button onclick="testRefreshButton()">æ¸¬è©¦ REFRESH åŠŸèƒ½</button>
        <div id="refresh-results" class="log"></div>
    </div>

    <div class="test-section">
        <h2>5. åˆ†æ•¸å‹•ç•«æ¸¬è©¦</h2>
        <button onclick="testScoreAnimation()">æ¸¬è©¦åˆ†æ•¸å‹•ç•«</button>
        <div id="score-results" class="log"></div>
        <div style="display: flex; gap: 10px; margin-top: 10px;">
            <div id="test-score" style="font-size: 2rem; color: #d4af37;">0.0</div>
        </div>
    </div>

    <div class="test-section">
        <h2>æ¸¬è©¦ç¸½çµ</h2>
        <div id="summary">
            <p>é»æ“Šä¸Šæ–¹æŒ‰éˆ•é–‹å§‹æ¸¬è©¦...</p>
        </div>
    </div>

    <script>
        let testResults = {
            api: null,
            system: null,
            tabs: null,
            refresh: null,
            score: null
        };

        function logMessage(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const entry = document.createElement('div');
            entry.className = `log-entry ${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        async function testAPIs() {
            const container = 'api-results';
            document.getElementById(container).innerHTML = '';
            logMessage(container, 'é–‹å§‹æ¸¬è©¦ API endpoints...', 'info');

            let passed = 0;
            let failed = 0;

            // Test /api/system/status
            try {
                const res1 = await fetch('/api/system/status');
                const data1 = await res1.json();
                if (data1.hasOwnProperty('running')) {
                    logMessage(container, 'âœ“ /api/system/status - PASS', 'success');
                    passed++;
                } else {
                    logMessage(container, 'âœ— /api/system/status - FAIL (missing "running")', 'error');
                    failed++;
                }
            } catch (e) {
                logMessage(container, 'âœ— /api/system/status - ERROR: ' + e.message, 'error');
                failed++;
            }

            // Test /api/report
            try {
                const res2 = await fetch('/api/report');
                const data2 = await res2.json();
                if (data2.hasOwnProperty('total_score')) {
                    logMessage(container, 'âœ“ /api/report - PASS', 'success');
                    passed++;
                } else {
                    logMessage(container, 'âœ— /api/report - FAIL (missing "total_score")', 'error');
                    failed++;
                }
            } catch (e) {
                logMessage(container, 'âœ— /api/report - ERROR: ' + e.message, 'error');
                failed++;
            }

            // Test /api/charts
            try {
                const res3 = await fetch('/api/charts');
                const data3 = await res3.json();
                if (data3.hasOwnProperty('charts')) {
                    logMessage(container, 'âœ“ /api/charts - PASS', 'success');
                    passed++;
                } else {
                    logMessage(container, 'âœ— /api/charts - FAIL (missing "charts")', 'error');
                    failed++;
                }
            } catch (e) {
                logMessage(container, 'âœ— /api/charts - ERROR: ' + e.message, 'error');
                failed++;
            }

            testResults.api = { passed, failed };
            logMessage(container, `æ¸¬è©¦å®Œæˆ: ${passed} passed, ${failed} failed`, passed === 3 ? 'success' : 'error');
            updateSummary();
        }

        async function testSystemStatus() {
            const container = 'system-results';
            document.getElementById(container).innerHTML = '';
            logMessage(container, 'æ¸¬è©¦ç³»çµ±ç‹€æ…‹æŸ¥è©¢...', 'info');

            try {
                const res = await fetch('/api/system/status');
                const data = await res.json();

                logMessage(container, `Running: ${data.running}`, 'info');
                logMessage(container, `Camera Mode: ${data.camera_mode}`, 'info');
                logMessage(container, `PID: ${data.pid || 'N/A'}`, 'info');
                logMessage(container, 'âœ“ ç³»çµ±ç‹€æ…‹æŸ¥è©¢æˆåŠŸ', 'success');

                testResults.system = { passed: 1, failed: 0 };
            } catch (e) {
                logMessage(container, 'âœ— éŒ¯èª¤: ' + e.message, 'error');
                testResults.system = { passed: 0, failed: 1 };
            }

            updateSummary();
        }

        async function testStartSystem() {
            const container = 'system-results';
            logMessage(container, 'æ¸¬è©¦å•Ÿå‹•ç³»çµ± (æ¨¡æ“¬è«‹æ±‚)...', 'info');
            logMessage(container, 'âš ï¸ é€™æ˜¯æ¨¡æ“¬æ¸¬è©¦ï¼Œä¸æœƒçœŸçš„å•Ÿå‹•ç³»çµ±', 'info');

            // æ¨¡æ“¬è«‹æ±‚æ ¼å¼
            const payload = { camera_mode: 'SINGLE' };
            logMessage(container, 'Payload: ' + JSON.stringify(payload), 'info');
            logMessage(container, 'âœ“ è«‹æ±‚æ ¼å¼æ­£ç¢º', 'success');
        }

        async function testStopSystem() {
            const container = 'system-results';
            logMessage(container, 'æ¸¬è©¦åœæ­¢ç³»çµ± (æ¨¡æ“¬è«‹æ±‚)...', 'info');
            logMessage(container, 'âš ï¸ é€™æ˜¯æ¨¡æ“¬æ¸¬è©¦ï¼Œä¸æœƒçœŸçš„åœæ­¢ç³»çµ±', 'info');
            logMessage(container, 'âœ“ è«‹æ±‚æ ¼å¼æ­£ç¢º', 'success');
        }

        function testTabSwitching() {
            const container = 'tab-results';
            document.getElementById(container).innerHTML = '';
            logMessage(container, 'æ¸¬è©¦ Tab åˆ‡æ›é‚è¼¯...', 'info');

            // æ¨¡æ“¬ tab æ•¸æ“š
            const tabs = ['overview', 'customer', 'server'];
            let passed = 0;
            let failed = 0;

            tabs.forEach(tab => {
                try {
                    logMessage(container, `æ¨¡æ“¬åˆ‡æ›åˆ° ${tab} tab`, 'info');
                    // æ¨¡æ“¬ tab åˆ‡æ›é‚è¼¯
                    logMessage(container, `âœ“ ${tab} tab åˆ‡æ›æˆåŠŸ`, 'success');
                    passed++;
                } catch (e) {
                    logMessage(container, `âœ— ${tab} tab åˆ‡æ›å¤±æ•—: ${e.message}`, 'error');
                    failed++;
                }
            });

            testResults.tabs = { passed, failed };
            logMessage(container, `æ¸¬è©¦å®Œæˆ: ${passed} passed, ${failed} failed`, passed === 3 ? 'success' : 'error');
            updateSummary();
        }

        function testRefreshButton() {
            const container = 'refresh-results';
            document.getElementById(container).innerHTML = '';
            logMessage(container, 'æ¸¬è©¦ REFRESH æŒ‰éˆ•é‚è¼¯...', 'info');

            try {
                // æ¨¡æ“¬ refresh é‚è¼¯
                logMessage(container, '1. æ·»åŠ  loading class', 'info');
                logMessage(container, '2. é‡ç½®åˆ†æ•¸åˆ° 0', 'info');
                logMessage(container, '3. å»¶é² 1.5 ç§’', 'info');
                logMessage(container, '4. ç§»é™¤ loading class', 'info');
                logMessage(container, '5. é‡æ–°è¼‰å…¥åˆ†æ•¸å‹•ç•«', 'info');
                logMessage(container, 'âœ“ REFRESH é‚è¼¯æ­£ç¢º', 'success');

                testResults.refresh = { passed: 1, failed: 0 };
            } catch (e) {
                logMessage(container, 'âœ— éŒ¯èª¤: ' + e.message, 'error');
                testResults.refresh = { passed: 0, failed: 1 };
            }

            updateSummary();
        }

        function testScoreAnimation() {
            const container = 'score-results';
            document.getElementById(container).innerHTML = '';
            logMessage(container, 'æ¸¬è©¦åˆ†æ•¸å‹•ç•«...', 'info');

            const element = document.getElementById('test-score');
            const targetScore = 85.5;
            const duration = 1500;
            const start = performance.now();
            const startValue = 0;

            logMessage(container, `ç›®æ¨™åˆ†æ•¸: ${targetScore}`, 'info');
            logMessage(container, 'é–‹å§‹å‹•ç•«...', 'info');

            function update(currentTime) {
                const elapsed = currentTime - start;
                const progress = Math.min(elapsed / duration, 1);
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                const currentValue = startValue + (targetScore - startValue) * easeProgress;

                element.textContent = currentValue.toFixed(1);

                if (progress < 1) {
                    requestAnimationFrame(update);
                } else {
                    logMessage(container, 'âœ“ å‹•ç•«å®Œæˆ', 'success');
                    testResults.score = { passed: 1, failed: 0 };
                    updateSummary();
                }
            }

            requestAnimationFrame(update);
        }

        function updateSummary() {
            const summary = document.getElementById('summary');
            let totalPassed = 0;
            let totalFailed = 0;
            let completed = 0;

            Object.keys(testResults).forEach(key => {
                if (testResults[key]) {
                    totalPassed += testResults[key].passed;
                    totalFailed += testResults[key].failed;
                    completed++;
                }
            });

            const total = Object.keys(testResults).length;
            const percentage = Math.round((totalPassed / (totalPassed + totalFailed)) * 100) || 0;

            summary.innerHTML = `
                <h3>æ¸¬è©¦é€²åº¦: ${completed}/${total}</h3>
                <p><span class="status ${totalFailed === 0 ? 'pass' : 'fail'}">é€šé: ${totalPassed} | å¤±æ•—: ${totalFailed}</span></p>
                <p>æˆåŠŸç‡: ${percentage}%</p>
            `;
        }

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            console.log('æ¸¬è©¦é é¢å·²è¼‰å…¥');
        });
    </script>
</body>
</html>
