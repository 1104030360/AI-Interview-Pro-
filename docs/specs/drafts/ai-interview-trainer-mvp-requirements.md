# AI 面試訓練系統 MVP 需求文件

**版本：** v1.0
**日期：** 2025-01-02
**狀態：** Draft - MVP 階段

---

## 1. 專案概述

### 1.1 目標
將現有的雙鏡頭情緒分析系統（project.py）改造為單鏡頭 AI 面試訓練系統，幫助使用者透過情緒分析改善面試表現。

### 1.2 核心價值
- 利用現有的 DeepFace 情緒辨識技術
- 提供即時情緒回饋與評分
- 生成專業的面試表現分析報告
- 單人使用，無需第二鏡頭（第二鏡頭為選配功能）

---

## 2. 功能需求

### 2.1 核心功能（MVP 必備）

#### F1: 面試問題播放系統
- **輸入：** 預設問題庫（5-10 題基礎面試問題）
- **輸出：** 文字顯示問題 + 倒數計時器
- **技術：** 使用 OpenCV 在畫面上顯示文字
- **時長：** 每題 45-90 秒回答時間

#### F2: 單鏡頭情緒即時分析
- **使用現有功能：**
  - Cam0 (正面鏡頭) 捕捉使用者臉部
  - DeepFace 分析 7 種情緒（happy, sad, angry, fear, surprise, disgust, neutral）
  - 即時顯示當前情緒狀態
- **新增：**
  - 情緒穩定度指標（情緒變化頻率）
  - 緊張度偵測（fear 持續時間）

#### F3: 情緒評分系統
- **評分維度：**
  1. **情緒穩定度** (30%): 避免情緒劇烈波動
  2. **自信度** (40%): happy + neutral 比例適中
  3. **壓力控制** (30%): fear + angry 比例低

- **計算公式：**
  ```
  總分 = 60 (基礎分)
       + 情緒穩定度 * 30
       - fear 比例 * 40
       + happy 比例 * 20
       - angry 比例 * 10

  最終分數範圍: 0-100 分
  ```

#### F4: 即時提示系統
- **觸發條件 → 提示訊息：**
  - fear 持續 > 5 秒 → "💡 深呼吸，放輕鬆"
  - angry 出現 → "💡 保持冷靜，微笑一下"
  - neutral 持續 > 15 秒 → "💡 試著微笑，展現親和力"
  - happy < 10% (整體) → "⚠️ 表情過於嚴肅"

#### F5: 面試報告生成
- **利用現有功能：**
  - 情緒波動折線圖（Customer_Emotion_Wave.jpg）
  - 情緒比例長條圖（Customer_Emotion_Bar.jpg）
  - Flask 報告系統（report_main.py + report2.HTML）

- **新增內容：**
  - 總分與評級（優秀/良好/需改進）
  - 各題情緒分析摘要
  - 改進建議（基於情緒數據）
  - 歷史練習對比（選配）

### 2.2 進階功能（Phase 2，可選）

#### F6: AI 智能建議（ChatGPT 整合）
- 根據情緒數據生成個人化改進建議
- 需要 OpenAI API 金鑰

#### F7: 語音播放問題
- 使用 pyttsx3 或預錄音檔播放問題
- 提升沉浸感

#### F8: 第二鏡頭擴充
- Cam1 捕捉全身或側面
- 姿態分析（駝背、手勢檢測）

---

## 3. 技術需求

### 3.1 現有技術棧（已具備）
- ✅ Python 3.x
- ✅ OpenCV (cv2)
- ✅ DeepFace (情緒分析)
- ✅ Keras (人物偵測模型)
- ✅ Matplotlib (圖表生成)
- ✅ Flask (Web 報告)
- ✅ PIL/Pillow (中文文字渲染)

### 3.2 需要新增的套件
```bash
# MVP 階段不需要新套件，使用現有技術即可
# Phase 2 可選：
# pip install pyttsx3  # 語音合成
# pip install openai   # ChatGPT API
```

### 3.3 程式架構調整

#### 主程式：interview_trainer.py
- 基於 project.py 改造
- **保留：**
  - DeepFace 情緒分析邏輯
  - 圖表生成功能
  - 影片錄製功能
- **移除：**
  - Cam1 (第二鏡頭) 相關程式碼
  - Keras 人物偵測（改用固定開始/結束）
- **新增：**
  - 問題庫管理
  - 倒數計時顯示
  - 評分計算邏輯
  - 即時提示系統

#### 報告系統：interview_report.py
- 基於 report_main.py 改造
- 更新 HTML 模板為面試主題
- 新增評分顯示與建議區塊

---

## 4. 資料結構

### 4.1 問題庫格式
```python
interview_questions = [
    {
        'id': 1,
        'question': '請用一分鐘自我介紹',
        'duration': 60,  # 秒
        'category': 'basic',
        'ideal_emotions': {
            'happy': 0.3,    # 30% 微笑
            'neutral': 0.6,  # 60% 專業
            'fear': 0.1      # < 10% 緊張
        }
    },
    {
        'id': 2,
        'question': '你的優點是什麼？',
        'duration': 45,
        'category': 'basic',
        'ideal_emotions': {
            'happy': 0.4,
            'neutral': 0.5,
            'fear': 0.1
        }
    },
    # ... 更多問題
]
```

### 4.2 分析結果格式
```python
interview_result = {
    'session_id': 'interview_20250102_143022',
    'timestamp': '2025-01-02 14:30:22',
    'questions_answered': 5,
    'total_score': 78.5,
    'breakdown': {
        'emotion_stability': 25,  # /30
        'confidence': 32,         # /40
        'stress_control': 22      # /30
    },
    'emotions_stats': {
        'happy': 0.28,
        'neutral': 0.55,
        'fear': 0.12,
        'angry': 0.02,
        'sad': 0.01,
        'surprise': 0.01,
        'disgust': 0.01
    },
    'question_details': [
        {
            'question_id': 1,
            'question': '請用一分鐘自我介紹',
            'score': 82,
            'emotions': [...],
            'tips_shown': ['深呼吸，放輕鬆']
        },
        # ...
    ],
    'recommendations': [
        '你在回答技術問題時略顯緊張，建議多練習',
        '整體表現良好，微笑頻率適中',
        '情緒穩定度佳，保持這個狀態'
    ]
}
```

---

## 5. 使用流程

### 5.1 使用者操作流程
1. 執行 `python interview_trainer.py`
2. 系統顯示歡迎畫面，倒數 3 秒開始
3. 第一題問題顯示在畫面上
4. 使用者對著鏡頭回答（系統即時分析情緒）
5. 倒數結束，自動進入下一題
6. 所有問題回答完畢後，自動生成報告
7. 執行 `python interview_report.py` 查看報告（http://localhost:5000）

### 5.2 系統執行流程
```
開始
 ↓
初始化鏡頭 (Cam0)
 ↓
顯示歡迎 & 倒數 3 秒
 ↓
迴圈開始 (每一題)
 ├─ 顯示問題文字
 ├─ 啟動倒數計時
 ├─ 即時情緒分析
 ├─ 記錄情緒數據
 ├─ 必要時顯示提示
 ├─ 時間到 → 下一題
 └─ 迴圈結束
 ↓
計算總分
 ↓
生成圖表 (折線圖、長條圖)
 ↓
儲存結果 (JSON)
 ↓
釋放資源
 ↓
結束 (提示查看報告)
```

---

## 6. UI/UX 需求

### 6.1 訓練畫面（OpenCV 視窗）
```
┌─────────────────────────────────────────┐
│  🎯 AI 面試訓練系統                       │
│                                         │
│  問題 2/5: 你的優點是什麼？               │
│  ⏱️  剩餘時間: 35 秒                      │
│                                         │
│  ┌─────────────────┐                    │
│  │                 │  當前情緒: 😊 Happy  │
│  │  [鏡頭畫面]      │  穩定度: ████░ 80%  │
│  │                 │  自信度: ███░░ 65%  │
│  └─────────────────┘                    │
│                                         │
│  💡 提示: 保持微笑，很棒！                │
│                                         │
│  [情緒即時波動迷你圖]                     │
│  ～～～～～～～～～                       │
└─────────────────────────────────────────┘
```

### 6.2 報告畫面（Web 介面）
- 參考現有 report2.HTML 設計
- 更新為面試主題配色（藍色系專業風格）
- 新增區塊：
  - 總分與評級徽章
  - 各題詳細分析
  - 改進建議清單
  - 歷史對比（如有）

---

## 7. 非功能性需求

### 7.1 效能需求
- 鏡頭解析度: 320x240 (維持現有設定，確保流暢度)
- 幀率: 5 FPS (與 project.py 相同)
- 情緒分析延遲: < 200ms (DeepFace 預期效能)
- 報告生成時間: < 5 秒

### 7.2 相容性需求
- 作業系統: macOS (主要測試環境)
- Python 版本: 3.8+
- 鏡頭: 需要至少一個可用的攝影機 (索引 0)

### 7.3 易用性需求
- 無需額外配置，執行即用
- 錯誤訊息清晰（如鏡頭未連接）
- 支援按 'q' 隨時退出

---

## 8. 成功指標

### 8.1 技術指標
- ✅ MVP 在 2-3 天內完成
- ✅ 單鏡頭情緒分析準確率 > 80%
- ✅ 系統穩定運行無崩潰
- ✅ 報告正確生成（圖表 + 分數）

### 8.2 使用者體驗指標
- ✅ 問題顯示清晰易讀
- ✅ 即時提示有幫助
- ✅ 評分合理（與使用者主觀感受一致）
- ✅ 報告內容有參考價值

---

## 9. 風險與限制

### 9.1 技術限制
- DeepFace 在低解析度下準確率可能下降
- 側臉或遮擋情況偵測困難
- 環境光線影響情緒辨識

### 9.2 使用限制
- 僅支援單人使用
- 需要良好的光線環境
- 使用者需正對鏡頭

### 9.3 功能限制（MVP 階段）
- 問題庫固定，不支援自訂
- 無語音播放
- 無 AI 智能建議
- 無歷史記錄對比

---

## 10. 開發排程（預估）

### Day 1 (8 小時)
- [x] 建立問題庫資料結構 (1h)
- [x] 修改 project.py 為 interview_trainer.py (3h)
  - 移除雙鏡頭邏輯
  - 加入問題顯示與倒數
- [x] 實作評分計算邏輯 (2h)
- [x] 測試基本流程 (2h)

### Day 2 (8 小時)
- [x] 實作即時提示系統 (2h)
- [x] 調整圖表生成（改為面試主題） (2h)
- [x] 修改 report2.HTML 為面試報告 (3h)
- [x] 整合測試與 Debug (1h)

### Day 3 (選配，進階功能)
- [ ] ChatGPT API 整合 (4h)
- [ ] 語音播放功能 (2h)
- [ ] UI 美化 (2h)

---

## 11. 附錄

### 11.1 現有程式碼資產清單
- ✅ `project.py` - 雙鏡頭情緒分析主程式（452 行）
- ✅ `Auto_Switch.py` - 自動啟動觸發器
- ✅ `report_main.py` - Flask 報告伺服器
- ✅ `report2.HTML/CSS/JS` - 報告網頁模板
- ✅ Keras 模型與標籤（人物偵測，可選用）
- ✅ 中文字型（NotoSansTC）
- ✅ Haarcascade XML（臉部偵測，可選用）

### 11.2 預期產出檔案清單
```
interview_trainer.py          # 主程式
interview_report.py           # 報告伺服器
interview_questions.json      # 問題庫（可選用 JSON 格式）
interview_result_YYYYMMDD.json  # 結果資料
Interview_Emotion_Wave.jpg    # 情緒波動圖
Interview_Emotion_Bar.jpg     # 情緒比例圖
interview_report.html         # 報告模板
output_interview.mp4          # 錄影檔案（選配）
```

---

## 12. 下一步行動

1. ✅ 審核此需求文件
2. ⏳ 建立 interview_questions.json 問題庫
3. ⏳ 開始開發 interview_trainer.py
4. ⏳ 測試並迭代

---

**備註：** 此文件為 MVP 階段需求，著重於快速驗證核心概念。進階功能將在 Phase 2 評估後決定是否實作。
